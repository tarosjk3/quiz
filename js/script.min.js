import{fetchQuestionsFromAirtable}from"./airtable.js";console.log("started");const quizStartBtn=document.querySelector("#quiz-start-btn"),quizStart=document.querySelector("#quiz-start"),loading=document.querySelector("#loading"),progressFill=document.querySelector("#progress-fill"),currentQuestion=document.querySelector("#progress-text"),questionNum=document.querySelector("#question-num"),question=document.querySelector("#question"),choiceInputs=document.querySelectorAll('input[name="choice"]'),choiceA=document.querySelector("#choice-a"),choiceB=document.querySelector("#choice-b"),choiceC=document.querySelector("#choice-c"),explanation=document.querySelector("#explanation"),explanationSpace=document.querySelector("#explanation-space"),hint=document.querySelector("#hint"),checkAnswerBtn=document.querySelector("#check-answer"),nextQuestionBtn=document.querySelector("#next-question"),checkResultBtn=document.querySelector("#check-result"),quizResult=document.querySelector("#quiz-result"),score=document.querySelector("#score"),accuracy=document.querySelector("#accuracy"),startOverBtn=document.querySelector("#start-over");let questions=[];const fallbackQuestions=[{id:1,question:"大きくて強い肉食恐竜で、短い前あしが特徴的なのは次のうちどれでしょう？",choices:{a:"トリケラトプス",b:"ティラノサウルス",c:"プテラノドン"},correct:"b",explanation:"ティラノサウルス（T-Rex）は、大きな体と短い前あしが特徴の肉食恐竜です。",hint:"「恐竜の王様」とも呼ばれる、とても有名で人気の恐竜です。"},{id:2,question:"顔に3本の角を持つ草食恐竜は次のうちどれでしょう？",choices:{a:"ステゴサウルス",b:"トリケラトプス",c:"ブラキオサウルス"},correct:"b",explanation:"トリケラトプスは、名前の「トリ」が「3」を意味するように、顔に3本の角を持つ植物食の恐竜です。",hint:"名前の「トリ」は数字の3という意味があります。"},{id:3,question:"ブラキオサウルスのように首がとても長く、高い木の葉っぱを食べていた恐竜は、肉食恐竜と草食恐竜のどちらでしょう？",choices:{a:"肉食恐竜",b:"草食恐竜",c:"雑食恐竜"},correct:"b",explanation:"木の葉っぱや草などの植物を食べる恐竜は、草食恐竜と呼ばれます。",hint:"「草」食恐竜は、何を食べる恐竜でしょうか？"},{id:4,question:"大昔にほとんどの恐竜がいなくなってしまった一番大きな理由として、科学者が考えているのは次のうちどれでしょう？",choices:{a:"恐竜同士のケンカが激しすぎたから",b:"地面がとても冷たくなってしまったから",c:"大きな隕石が地球にぶつかったから"},correct:"c",explanation:"巨大な隕石が地球に衝突し、その後に起きた環境の変化が恐竜の絶滅の主な原因という説が最も有力です。",hint:"宇宙から飛んできた、とても大きなものが関係しています。"},{id:5,question:"次の恐竜の名前の中で、「恐竜」（Dinosaur）ではないものはどれでしょう？",choices:{a:"スピノサウルス",b:"プテラノドン",c:"ヴェロキラプトル"},correct:"b",explanation:"プテラノドンは空を飛ぶ翼竜（よくりゅう）の仲間で、正確には「恐竜」には分類されません。",hint:"この生き物は、翼を広げて空を飛ぶことができました。"}];let currentQuestionIndex=0,correctAnswers=0;function displayQuestion(e){const t=questions[e];questionNum.textContent=t.id,question.textContent=t.question,choiceA.textContent=t.choices.a,choiceB.textContent=t.choices.b,choiceC.textContent=t.choices.c,hint.textContent=t.hint,currentQuestion.textContent=`${e+1}/${questions.length}`,progressFill.style.width=(e+1)/questions.length*100+"%";for(let e=0;e<choiceInputs.length;e++)choiceInputs[e].checked=!1,choiceInputs[e].disabled=!1;explanationSpace.classList.remove("is-shown")}quizStartBtn.addEventListener("click",(async()=>{quizStartBtn.disabled=!0,quizStartBtn.classList.add("is-hidden"),loading.classList.remove("is-hidden"),questions=await fetchQuestionsFromAirtable(),console.log(questions),0===questions.length&&(questions=fallbackQuestions,console.warn("Airtableからのデータ取得に失敗しました。フォールバックデータを使用します。")),questions.length>0?(quizStart.classList.add("is-started"),displayQuestion(currentQuestionIndex),setTimeout((()=>{loading.classList.add("is-hidden")}),1e3)):alert("問題データがありません")})),choiceInputs.forEach((e=>{e.addEventListener("change",(()=>{checkAnswerBtn.disabled=!1}))})),checkAnswerBtn.addEventListener("click",(()=>{const e=questions[currentQuestionIndex],t=document.querySelector('input[name="choice"]:checked'),n=t.value,c=e.correct;if(n===c)t.classList.add("correct"),correctAnswers++;else{document.querySelector(`input[value="${c}"]`).classList.add("correct"),t.classList.add("incorrect")}explanation.textContent=e.explanation,explanationSpace.classList.add("is-shown"),choiceInputs.forEach((e=>{e.disabled=!0})),checkAnswerBtn.disabled=!0,currentQuestionIndex<questions.length-1?nextQuestionBtn.disabled=!1:(checkResultBtn.disabled=!1,checkResultBtn.classList.add("is-shown"))})),nextQuestionBtn.addEventListener("click",(()=>{choiceInputs.forEach((e=>{e.classList.remove("correct","incorrect")})),currentQuestionIndex++,displayQuestion(currentQuestionIndex),nextQuestionBtn.disabled=!0})),checkResultBtn.addEventListener("click",(()=>{choiceInputs.forEach((e=>{e.classList.remove("correct","incorrect"),e.checked=!1})),questionNum.textContent="",question.textContent="",choiceA.textContent="",choiceB.textContent="",choiceC.textContent="",hint.textContent="",currentQuestion.textContent="",progressFill.style.width="0%",explanationSpace.classList.remove("is-shown"),checkAnswerBtn.disabled=!0,nextQuestionBtn.disabled=!0,checkResultBtn.disabled=!0,checkResultBtn.classList.remove("is-shown");const e=Math.round(correctAnswers/questions.length*100);score.textContent=`${correctAnswers}/${questions.length}`,accuracy.textContent=e,quizResult.classList.add("is-shown")})),startOverBtn.addEventListener("click",(()=>{currentQuestionIndex=0,correctAnswers=0,quizResult.classList.remove("is-shown"),quizStart.classList.remove("is-started"),quizStartBtn.disabled=!1,quizStartBtn.classList.remove("is-hidden")}));